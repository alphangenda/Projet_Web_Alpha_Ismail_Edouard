{% extends 'base.html' %}
{% load static %}

{% block title %}Map de location - EcoFlex{% endblock %}

{% block extra_css %}
<style>
    .search-widget {
        background: rgba(255, 255, 255, 0.55);
        backdrop-filter: blur(12px);
        border-radius: 20px;
        padding: 25px 45px;
        border-radius: 20px;
        border: 1.5px solid rgba(40, 167, 69, 0.22);
        box-shadow: 0 8px 18px rgba(0, 0, 0, 0.04);
        transition: all 0.6s ease;
        position: relative;
        z-index: 1000;
    }

    .search-widget:hover {
        transform: translateY(-4px) scale(1.01);
        border: 2px solid rgba(0, 0, 0, 0.1);
        box-shadow: 0 9px 20px rgba(0, 0, 0, 0.8);

    }

    .search-title {
        letter-spacing: .5px;
        font-size: 18px;
        font-weight: 700;
        color: #0f172a;
        margin-bottom: 18px;
    }

    .search-container {
        position: relative;
    }

    .search-input {
        width: 100%;
        padding: 14px 18px;
        border-radius: 14px;
        border: 1.5px solid rgba(0, 0, 0, 0.04);
        background: linear-gradient(180deg, #f8fafc 0%, #ffffff 100%);
        backdrop-filter: blur(8px);
        font-size: 16px;
        outline: none;
        transition: all .25s ease;
    }

    .search-input:focus {
        border-color: #28a745;
        box-shadow: 0 0 14px rgba(40, 167, 69, 0.5);
        background: rgba(255, 255, 255, 0.9);
    }

    #conteneur-recherche-ajax {
        position: relative;
        z-index: 1001;
    }

    .search-results {
        position: absolute;
        width: 100%;
        top: calc(100% + 6px);
        left: 0;
        background: rgba(255, 255, 255, 0.95);
        border-radius: 16px;
        border: 1px solid #d4d4d4;
        box-shadow: 0 8px 26px rgba(0, 0, 0, 0.12);
        overflow: hidden;
        display: none;
        animation: fadeDown .25s ease;
        z-index: 10000 !important;
    }

    .search-results .list-group-item {
        padding: 14px 16px !important;
        border: none !important;
        transition: background .2s ease;
        z-index: 9999999;
    }

    .search-results .list-group-item:hover {
        background: rgba(40, 167, 69, 0.1);
    }

    @keyframes fadeDown {
        from {
            opacity: 0;
            transform: translateY(-6px);
        }

        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .filter-card {
        background: rgba(255, 255, 255, 0.55);
        backdrop-filter: blur(12px);
        border-radius: 22px;
        padding: 25px 30px;
        border: 1.5px solid rgba(40, 167, 69, 0.22);
        box-shadow: 0 8px 22px rgba(0, 0, 0, 0.07);
        transition: all .3s ease;
        z-index: 1;
    }

    .filter-card:hover {
        transform: translateY(-3px);
        box-shadow: 0 12px 30px rgba(40, 167, 69, 0.28);
    }

    .filter-card-title {
        font-size: 18px;
        font-weight: 700;
        color: #0f172a;
        margin-bottom: 18px;
    }

    .filter-card label {
        font-size: 14px;
        font-weight: 600;
        color: #3f3f3f;
    }

    .filter-card .form-control,
    .filter-card .form-select {
        border-radius: 14px;
        border: 1.5px solid rgba(0, 0, 0, 0.04);
        background: linear-gradient(180deg, #f8fafc 0%, #ffffff 100%);
        backdrop-filter: blur(8px);
        font-size: 15px;
        padding: 12px 14px;
        transition: all .25s;
    }

    .filter-card .form-control:focus,
    .filter-card .form-select:focus {
        border-color: #28a745;
        box-shadow: 0 0 12px rgba(40, 167, 69, 0.55);
        background: rgba(255, 255, 255, 0.95);
    }

    .filter-card .btn-success {
        background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
        border: none;
        padding: 12px 0;
        border-radius: 14px;
        font-weight: 600;
        font-size: 16px;
        transition: all .25s;
    }

    .filter-card .btn-success:hover {
        box-shadow: 0 6px 18px rgba(32, 201, 151, 0.5);
        transform: translateY(-2px);
    }





    @keyframes slideIn {
        from {
            opacity: 0;
            transform: translateY(-10px);
        }

        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
</style>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
{% endblock %}

{% block content %}
{% if messages %}
<div>
    <div class="alert
            {% if message.tags == 'success' %}alert-success{% endif %} role=" alert">
        {{ message }}
    </div>
</div>
{% endif %}
<div class="container mt-4">

    <div class="search-widget mb-4">
        <h6 class="search-title">Recherche rapide de stations</h6>

        <div id="conteneur-recherche-ajax" class="search-container">
            <input type="text" id="input-recherche-ajax" class="search-input" placeholder="Rechercher une station…"
                autocomplete="off">

            <div id="resultats-recherche-ajax" class="search-results"></div>
        </div>
    </div>

    <div class="card shadow-sm mb-4 filter-card">
        <div class="card-body">
            <h5 class="card-title mb-3 filter-card-title">Filtrer par distance depuis votre position</h5>
            <form id="formulaireFiltre" class="row g-3">
                <div class="col-md-4">
                    <label for="adresse" class="form-label">Adresse ou lieu</label>
                    <input type="text" class="form-control" id="adresse"
                        placeholder="Ex: 325 boulevard Charest Est, Québec">
                </div>
                <div class="col-md-3">
                    <label for="distanceMax" class="form-label">Distance maximale (km)</label>
                    <select class="form-select" id="distanceMax">
                        <option value="1000">Tous les véhicules</option>
                        <option value="0.5">0.5 km</option>
                        <option value="1" selected>1 km</option>
                        <option value="2">2 km</option>
                        <option value="5">5 km</option>
                        <option value="10">10 km</option>
                    </select>
                </div>
                <div class="col-md-3">
                    <label for="typeVehicule" class="form-label">Type de véhicule</label>
                    <select class="form-select" id="typeVehicule">
                        <option value="">Tous</option>
                        <option value="velo">Vélo</option>
                        <option value="trottinette">Trottinette</option>
                        <option value="voiture">Voiture</option>
                    </select>
                </div>
                <div class="col-md-2">
                    <label class="form-label">&nbsp;</label>
                    <button type="submit" class="btn btn-success w-100" id="rechercheDistance">Rechercher</button>
                </div>
            </form>
        </div>
    </div>

    <div id="resultatsRecherche" class="alert alert-info" style="display: none;">
        <strong>Résultats :</strong> <span id="nombreResultats">0</span> station(s) trouvé(s)
    </div>

    <div id="map" style="height: 600px; border-radius: 12px;"></div>

    <div class="alert alert-info text-center mt-4" role="alert">
        Vous pouvez zoomer, dézoomer et vous déplacer sur la carte de Québec.
    </div>
</div>

{% endblock %}



{% block extra_js %}
<script>
    window.utilisateurConnecte = "{{ user.is_authenticated|yesno:'true,false' }}" === "true";
    window.isAdmin = "{{ user.is_staff|yesno:'true,false' }}" === "true";
</script>



<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

<script src="{% static 'ecoflex/js/carte_membre.js' %}"></script>
<script src="{% static 'ecoflex/js/location.js' %}"></script>
<script src="{% static 'ecoflex/js/carte.js' %}"></script>

<script src="{% static 'ecoflex/js/filtre_map_position.js' %}"></script>


<script src="{% static 'ecoflex/js/recherche_ajax.js' %}"></script>

{% endblock %}